# æ‹›å•†é“¶è¡Œä¿¡ç”¨å¡å•†åŸæ™ºèƒ½å®¢æœå¼€å‘éœ€æ±‚æ–‡æ¡£

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

åœ¨å·²æœ‰çš„åŸºç¡€ç”µå•†ç³»ç»ŸåŸºç¡€ä¸Šï¼Œå¼€å‘ä¸€ä¸ªä¸“æ³¨äºä¿¡ç”¨å¡ä»·å€¼æ¨å¹¿çš„æ™ºèƒ½å®¢æœç³»ç»Ÿï¼Œé€šè¿‡AIå¯¹è¯å¼•å¯¼ç”¨æˆ·é€‰æ‹©ä¿¡ç”¨å¡æ”¯ä»˜ï¼Œæå‡ä¿¡ç”¨å¡ä½¿ç”¨ç‡ã€‚

### 1.2 æ ¸å¿ƒç›®æ ‡

- **ä¸»è¦ç›®æ ‡**ï¼šé€šè¿‡æ™ºèƒ½å¯¹è¯å¼•å¯¼ç”¨æˆ·ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜
- **æ¬¡è¦ç›®æ ‡**ï¼šæä¾›åŸºç¡€å®¢æœåŠŸèƒ½ï¼Œè§£ç­”ç”¨æˆ·ç–‘é—®
- **ä¸šåŠ¡ç›®æ ‡**ï¼šæå‡ä¿¡ç”¨å¡æ”¯ä»˜å æ¯”20%ä»¥ä¸Š

### 1.3 è®¾è®¡åŸåˆ™

- æŠ€æœ¯å®ç°ç®€å•ï¼Œå¼€å‘å‘¨æœŸçŸ­
- çªå‡ºä¿¡ç”¨å¡ç‹¬ç‰¹ä»·å€¼
- è¿ç”¨å¿ƒç†æ¿€åŠ±æœºåˆ¶
- ç”¨æˆ·ä½“éªŒå‹å¥½

## äºŒã€åŠŸèƒ½éœ€æ±‚

### 2.1 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### æ¨¡å—1ï¼šæ”¯ä»˜å’¨è¯¢åŠ©æ‰‹ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

**åŠŸèƒ½æè¿°**ï¼šå½“ç”¨æˆ·å’¨è¯¢æ”¯ä»˜ç›¸å…³é—®é¢˜æ—¶ï¼Œæ™ºèƒ½æ¨èä¿¡ç”¨å¡æ”¯ä»˜

**è§¦å‘åœºæ™¯**ï¼š

- ç”¨æˆ·è¯¢é—®ï¼š"è¿™ä¸ªå•†å“æ€ä¹ˆä»˜æ¬¾ï¼Ÿ"
- ç”¨æˆ·è¯¢é—®ï¼š"æœ‰ä»€ä¹ˆä¼˜æƒ å—ï¼Ÿ"
- ç”¨æˆ·è¯¢é—®ï¼š"å¯ä»¥åˆ†æœŸå—ï¼Ÿ"

**AIå›å¤ç­–ç•¥**ï¼š

```
ç”¨æˆ·ï¼š"è¿™ä¸ªæ‰‹æœºå¯ä»¥åˆ†æœŸå—ï¼Ÿ"

å®¢æœå›å¤ï¼š
"å½“ç„¶å¯ä»¥ï¼ä½¿ç”¨æ‚¨çš„æ‹›å•†é“¶è¡Œä¿¡ç”¨å¡ï¼Œè¿™æ¬¾æ‰‹æœºæ”¯æŒï¼š
ğŸ 12æœŸå…æ¯åˆ†æœŸï¼Œæœˆä¾›ä»…éœ€416å…ƒ
ğŸ’° ç«‹å³è·å¾—288ç§¯åˆ†ï¼ˆä»·å€¼28.8å…ƒï¼‰
â° 48å¤©è¶…é•¿å…æ¯æœŸï¼Œ5æœˆ31æ—¥æ‰éœ€è¿˜æ¬¾
ğŸ’³ äº«å—è´­ç‰©ä¿é™©ï¼Œå•†å“æŸåå…¨é¢èµ”ä»˜

ç›¸æ¯”æ”¯ä»˜å®æ”¯ä»˜ï¼Œæ‚¨å°†é¢å¤–è·å¾—ä»·å€¼çº¦50å…ƒçš„æƒç›Šï¼
ç°åœ¨å°±ç”¨ä¿¡ç”¨å¡ä¸‹å•å§ï½"
```

#### æ¨¡å—2ï¼šç§¯åˆ†ä»·å€¼æ¨å¹¿ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

**åŠŸèƒ½æè¿°**ï¼šä¸»åŠ¨ä»‹ç»ç§¯åˆ†ä»·å€¼ï¼Œå¼•å¯¼ç”¨æˆ·å…³æ³¨ä¿¡ç”¨å¡æ”¶ç›Š

**è§¦å‘åœºæ™¯**ï¼š

- ç”¨æˆ·è¯¢é—®ç§¯åˆ†ç›¸å…³é—®é¢˜
- ç”¨æˆ·æµè§ˆé«˜ä»·å•†å“æ—¶ä¸»åŠ¨æ¨é€
- ç”¨æˆ·çŠ¹è±«æ”¯ä»˜æ–¹å¼æ—¶

**AIå›å¤ç¤ºä¾‹**ï¼š

```
ç”¨æˆ·ï¼š"ç§¯åˆ†æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"

å®¢æœå›å¤ï¼š
"æ‚¨çš„æ‹›è¡Œç§¯åˆ†å¯æ˜¯å¾ˆå€¼é’±çš„å“¦ï¼
ğŸ’ å½“å‰ç§¯åˆ†ï¼š8,500åˆ†ï¼ˆä»·å€¼85å…ƒï¼‰
ğŸ›ï¸ å¯ç›´æ¥æŠµæ‰£ç°é‡‘ä½¿ç”¨
ğŸ å…‘æ¢ç²¾ç¾ç¤¼å“
âš¡ é‡è¦æé†’ï¼š2,000ç§¯åˆ†å°†åœ¨15å¤©ååˆ°æœŸï¼

å»ºè®®æ‚¨ï¼š
1. ç«‹å³ä½¿ç”¨ç§¯åˆ†æŠµæ‰£éƒ¨åˆ†å•†å“è´¹ç”¨
2. ç”¨ä¿¡ç”¨å¡æ”¯ä»˜å‰©ä½™é‡‘é¢ï¼Œè·å¾—æ–°ç§¯åˆ†
3. è¿™æ ·æ—¢ç”¨äº†å³å°†åˆ°æœŸçš„ç§¯åˆ†ï¼Œåˆèµšäº†æ–°ç§¯åˆ†ï¼

è¦æˆ‘å¸®æ‚¨è®¡ç®—æœ€ä¼˜æ­é…æ–¹æ¡ˆå—ï¼Ÿ"
```

#### æ¨¡å—3ï¼šæƒç›Šä»·å€¼å±•ç¤ºï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

**åŠŸèƒ½æè¿°**ï¼šæ ¹æ®ç”¨æˆ·å¡ç­‰çº§ï¼Œå±•ç¤ºä¸“å±æƒç›Šä»·å€¼

**å®ç°é€»è¾‘**ï¼š

- è¯†åˆ«ç”¨æˆ·ä¿¡ç”¨å¡ç­‰çº§
- åŒ¹é…å¯¹åº”æƒç›Šå†…å®¹
- çªå‡ºç‹¬äº«ä»·å€¼

#### æ¨¡å—4ï¼šFAQæ™ºèƒ½é—®ç­”ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

**åŠŸèƒ½æè¿°**ï¼šå›ç­”å¸¸è§è´­ç‰©é—®é¢˜ï¼Œä½†å·§å¦™èå…¥ä¿¡ç”¨å¡æ¨å¹¿

**å¸¸è§é—®é¢˜å¤„ç†**ï¼š

```
Q: "è®¢å•ä»€ä¹ˆæ—¶å€™å‘è´§ï¼Ÿ"
A: "æ‚¨çš„è®¢å•é¢„è®¡æ˜å¤©å‘è´§å“¦ï½
   ğŸ’¡å°è´´å£«ï¼šä¸‹æ¬¡è´­ä¹°å»ºè®®ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜ï¼Œå¯ä»¥äº«å—ç‰©æµä¿é™©ï¼Œ
   ä¸‡ä¸€åŒ…è£¹ä¸¢å¤±æˆ–æŸåï¼Œæ‹›è¡Œä¸ºæ‚¨å…¨é¢èµ”ä»˜ï¼"

Q: "å¯ä»¥é€€è´§å—ï¼Ÿ"
A: "å½“ç„¶å¯ä»¥é€€è´§ï¼7å¤©æ— ç†ç”±é€€æ¢ã€‚
   ğŸ¯ç‰¹åˆ«è¯´æ˜ï¼šä¿¡ç”¨å¡æ”¯ä»˜çš„è®¢å•ï¼Œé€€è´§æ›´ä¾¿æ·ï¼Œ
   è¿˜äº«å—é€€è´§è¿è´¹é™©ï¼Œå®Œå…¨é›¶é£é™©è´­ç‰©ä½“éªŒï¼"
```

### 2.2 å¿ƒç†æ¿€åŠ±æœºåˆ¶è®¾è®¡

#### 2.2.1 æŸå¤±åŒæ¶åº”ç”¨

**å®ç°ç­–ç•¥**ï¼šå¼ºè°ƒä¸ç”¨ä¿¡ç”¨å¡çš„"æŸå¤±"

```
"é€‰æ‹©æ”¯ä»˜å®æ”¯ä»˜å°†é”™å¤±ï¼š
âŒ 188ç§¯åˆ†å¥–åŠ±ï¼ˆä»·å€¼18.8å…ƒï¼‰
âŒ 12æœŸå…æ¯åˆ†æœŸæƒç›Š
âŒ è´­ç‰©ä¿é™©ä¿éšœ
âŒ ç§¯åˆ†ç¿»å€æ´»åŠ¨å‚ä¸èµ„æ ¼

ç¡®å®šè¦æ”¾å¼ƒè¿™äº›ä»·å€¼çº¦60å…ƒçš„æƒç›Šå—ï¼Ÿ"
```

#### 2.2.2 ç¨€ç¼ºæ€§è¥é€ 

**å®ç°ç­–ç•¥**ï¼šé™æ—¶ä¼˜æƒ å’Œä¸“å±æƒç›Š

```
"âš¡é™æ—¶ä¸“äº«ï¼š
æ‚¨çš„ç™½é‡‘å¡ç”¨æˆ·ä¸“å±8.8æŠ˜ä¼˜æƒ ä»…å‰©2å°æ—¶ï¼
å…¨ç«™ä»…é™100åç™½é‡‘å¡ç”¨æˆ·äº«å—ï¼Œå…ˆåˆ°å…ˆå¾—ï¼
ç«‹å³ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜ï¼Œäº«å—ä¸“å±ç‰¹æƒï½"
```

#### 2.2.3 ç¤¾ä¼šè®¤åŒ

**å®ç°ç­–ç•¥**ï¼šå±•ç¤ºå…¶ä»–ç”¨æˆ·é€‰æ‹©

```
"ğŸ’¡å‹æƒ…æç¤ºï¼š
ä»Šæ—¥å·²æœ‰89%çš„ç”¨æˆ·é€‰æ‹©ä¿¡ç”¨å¡æ”¯ä»˜
å¹³å‡æ¯äººé€šè¿‡ä¿¡ç”¨å¡æ”¯ä»˜èŠ‚çœäº†32å…ƒ
åŠ å…¥èªæ˜æ¶ˆè´¹è€…çš„è¡Œåˆ—ï¼Œç«‹å³é€‰æ‹©ä¿¡ç”¨å¡æ”¯ä»˜ï¼"
```

## ä¸‰ã€æŠ€æœ¯æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„

```
å‰ç«¯ (React)
    â†“
åç«¯ (Spring Boot)
    â†“
Redisç¼“å­˜ä¸­é—´ä»¶
    â†“
AIæœåŠ¡ (é€šä¹‰åƒé—®API)
    â†“
æ•°æ®åº“ (MySQL)
```

#### 3.1.1 Redisä¸­é—´ä»¶æ¶æ„

```
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç† (Redis Sessionå­˜å‚¨)
    â†“
æ™ºèƒ½ç¼“å­˜æ£€æŸ¥ (Redis Cache)
    â†“ (ç¼“å­˜æœªå‘½ä¸­)
AIæœåŠ¡è°ƒç”¨
    â†“
ç¼“å­˜AIå“åº” (Redis Cache)
    â†“
è¿”å›ç»“æœ
```

### 3.2 æ ¸å¿ƒç»„ä»¶

#### 3.2.1 å¯¹è¯ç®¡ç†å™¨ (DialogManager)

**èŒè´£**ï¼š

- ç®¡ç†å¯¹è¯çŠ¶æ€
- è·¯ç”±ç”¨æˆ·æ¶ˆæ¯åˆ°åˆé€‚çš„å¤„ç†å™¨
- ç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡

#### 3.2.2 æ„å›¾è¯†åˆ«å™¨ (IntentRecognizer)

**èŒè´£**ï¼š

- è¯†åˆ«ç”¨æˆ·è¯¢é—®ç±»å‹
- æå–å…³é”®ä¿¡æ¯ï¼ˆå•†å“IDã€ä»·æ ¼ç­‰ï¼‰
- è§¦å‘å¯¹åº”çš„å›å¤ç­–ç•¥

#### 3.2.4 Redisç¼“å­˜ä¸­é—´ä»¶ (CacheMiddleware)

**èŒè´£**ï¼š

- ç¼“å­˜AI APIå“åº”ï¼Œå‡å°‘é‡å¤è°ƒç”¨
- ç¼“å­˜ç”¨æˆ·ä¿¡ç”¨å¡ä¿¡æ¯ï¼Œæå‡æŸ¥è¯¢é€Ÿåº¦
- ç®¡ç†å¯¹è¯ä¸Šä¸‹æ–‡çŠ¶æ€
- ç¼“å­˜å¸¸è§é—®é¢˜ç­”æ¡ˆ

#### 3.2.5 å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨ (ContextManager)

**èŒè´£**ï¼š

- ç»´æŠ¤ç”¨æˆ·å¯¹è¯ä¼šè¯çŠ¶æ€
- è®°å½•ç”¨æˆ·æµè§ˆå•†å“å†å²
- è·Ÿè¸ªä¿¡ç”¨å¡æ¨å¹¿æ¬¡æ•°
- æ™ºèƒ½å…³è”ä¸Šä¸‹æ–‡ä¿¡æ¯

### 3.3 æ•°æ®åº“è®¾è®¡

#### 3.3.1 MySQLè¡¨ç»“æ„

```sql
-- å®¢æœå¯¹è¯è®°å½•è¡¨
CREATE TABLE customer_service_chat (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT,
    session_id VARCHAR(64),
    user_message TEXT,
    bot_response TEXT,
    intent_type VARCHAR(32),
    cache_hit BOOLEAN DEFAULT FALSE,
    response_time_ms INT,
    created_time DATETIME,
    INDEX idx_user_session (user_id, session_id),
    INDEX idx_created_time (created_time)
);

-- ç”¨æˆ·ä¿¡ç”¨å¡ä¿¡æ¯è¡¨
CREATE TABLE user_credit_card (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT,
    card_level ENUM('GOLD', 'PLATINUM', 'DIAMOND'),
    points_balance INT DEFAULT 0,
    points_expiring INT DEFAULT 0,
    expiring_date DATE,
    credit_limit DECIMAL(10,2),
    bill_date INT,
    due_date INT,
    created_time DATETIME,
    updated_time DATETIME,
    UNIQUE KEY uk_user_id (user_id)
);

-- FAQçŸ¥è¯†åº“è¡¨
CREATE TABLE faq_knowledge (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    question VARCHAR(255),
    answer TEXT,
    category VARCHAR(32),
    credit_card_promotion TEXT,
    hit_count INT DEFAULT 0,
    status TINYINT DEFAULT 1,
    INDEX idx_category (category)
);

-- ç”¨æˆ·è¡Œä¸ºåˆ†æè¡¨
CREATE TABLE user_behavior_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT,
    session_id VARCHAR(64),
    action_type VARCHAR(32),
    action_data JSON,
    created_time DATETIME,
    INDEX idx_user_time (user_id, created_time),
    INDEX idx_action_type (action_type)
);
```

#### 3.3.2 Redisæ•°æ®ç»“æ„è®¾è®¡

##### ç¼“å­˜ç­–ç•¥

```
1. AIå“åº”ç¼“å­˜
   Key: ai_response:{md5(question+context)}
   Value: AIå“åº”å†…å®¹ (String)
   TTL: 1å°æ—¶

2. ç”¨æˆ·ä¿¡ç”¨å¡ä¿¡æ¯ç¼“å­˜
   Key: user_card:{userId}
   Value: UserCreditCardå¯¹è±¡ (Hash)
   TTL: 10åˆ†é’Ÿ

3. å¯¹è¯ä¸Šä¸‹æ–‡ç¼“å­˜
   Key: chat_context:{sessionId}
   Value: ChatContextå¯¹è±¡ (Hash)
   TTL: 30åˆ†é’Ÿ

4. FAQç¼“å­˜
   Key: faq:{keyword}
   Value: FAQåˆ—è¡¨ (List)
   TTL: 1å¤©

5. ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ç¼“å­˜
   Key: user_stats:{userId}:{date}
   Value: è¡Œä¸ºç»Ÿè®¡æ•°æ® (Hash)
   TTL: 7å¤©

6. çƒ­é—¨é—®é¢˜ç¼“å­˜
   Key: hot_questions:{date}
   Value: é—®é¢˜åˆ—è¡¨ (ZSetï¼ŒæŒ‰çƒ­åº¦æ’åº)
   TTL: 1å¤©
```

##### Redisé…ç½®ç¤ºä¾‹

```yaml
spring:
  redis:
    host: localhost
    port: 6379
    password: 
    database: 0
    timeout: 3000ms
    lettuce:
      pool:
        max-active: 8
        max-wait: -1ms
        max-idle: 8
        min-idle: 0
```

## å››ã€æ¥å£è®¾è®¡

### 4.1 æ ¸å¿ƒAPIæ¥å£

#### 4.1.1 å‘é€æ¶ˆæ¯æ¥å£

```java
POST /api/customer-service/chat

Request:
{
    "userId": 12345,
    "sessionId": "session_abc123",
    "message": "è¿™ä¸ªå•†å“å¯ä»¥åˆ†æœŸå—ï¼Ÿ",
    "context": {
        "productId": 67890,
        "productPrice": 4999,
        "currentPage": "product_detail"
    }
}

Response:
{
    "code": 200,
    "data": {
        "responseId": "resp_123",
        "message": "å½“ç„¶å¯ä»¥åˆ†æœŸï¼ä½¿ç”¨æ‹›è¡Œä¿¡ç”¨å¡...",
        "suggestions": ["äº†è§£æ›´å¤šæƒç›Š", "ç«‹å³ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜"],
        "promotionInfo": {
            "type": "credit_card_benefits",
            "pointsEarned": 288,
            "discountAmount": 50.0,
            "installmentOptions": [6, 12, 24]
        }
    }
}
```

#### 4.1.2 è·å–ç”¨æˆ·ä¿¡ç”¨å¡ä¿¡æ¯æ¥å£

```java
GET /api/user/credit-card-info/{userId}

Response:
{
    "code": 200,
    "data": {
        "cardLevel": "PLATINUM",
        "pointsBalance": 8500,
        "pointsExpiring": 2000,
        "expiringDate": "2024-04-15",
        "availableCredit": 45000.00,
        "nextBillDate": "2024-04-10"
    }
}
```

### 4.2 AIæœåŠ¡é›†æˆä¸ç¼“å­˜ä¼˜åŒ–

#### 4.2.1 æ™ºèƒ½ç¼“å­˜æœåŠ¡

```java
@Service
public class CacheOptimizedAIService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private AIServiceClient aiServiceClient;
    
    private static final String AI_CACHE_PREFIX = "ai_response:";
    private static final String CONTEXT_PREFIX = "chat_context:";
    
    public AIResponse getCachedOrFreshResponse(String question, ChatContext context) {
        // 1. æ„å»ºç¼“å­˜key
        String cacheKey = buildCacheKey(question, context);
        
        // 2. æ£€æŸ¥ç¼“å­˜
        AIResponse cachedResponse = (AIResponse) redisTemplate.opsForValue().get(cacheKey);
        if (cachedResponse != null) {
            log.info("Cache hit for question: {}", question);
            return cachedResponse;
        }
        
        // 3. è°ƒç”¨AIæœåŠ¡
        AIResponse freshResponse = aiServiceClient.chat(question, context);
        
        // 4. ç¼“å­˜ç»“æœ
        redisTemplate.opsForValue().set(cacheKey, freshResponse, 1, TimeUnit.HOURS);
        
        return freshResponse;
    }
    
    private String buildCacheKey(String question, ChatContext context) {
        String contextData = String.format("%s_%s_%s", 
            context.getUserId(),
            context.getCurrentProductId(),
            context.getCurrentIntent());
        return AI_CACHE_PREFIX + DigestUtils.md5Hex(question + contextData);
    }
}
```

#### 4.2.2 å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†æœåŠ¡

```java
@Service
public class ContextManagementService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private static final String CONTEXT_PREFIX = "chat_context:";
    private static final int CONTEXT_TTL_MINUTES = 30;
    
    public void saveContext(String sessionId, ChatContext context) {
        String key = CONTEXT_PREFIX + sessionId;
        
        // ä¿å­˜åˆ°Redis
        redisTemplate.opsForHash().putAll(key, buildContextMap(context));
        redisTemplate.expire(key, CONTEXT_TTL_MINUTES, TimeUnit.MINUTES);
        
        log.debug("Context saved for session: {}", sessionId);
    }
    
    public ChatContext loadContext(String sessionId) {
        String key = CONTEXT_PREFIX + sessionId;
        Map<Object, Object> contextMap = redisTemplate.opsForHash().entries(key);
        
        if (contextMap.isEmpty()) {
            return new ChatContext(sessionId);
        }
        
        return buildContextFromMap(contextMap);
    }
    
    public void updateProductInterest(String sessionId, Long productId, BigDecimal price) {
        String key = CONTEXT_PREFIX + sessionId;
        redisTemplate.opsForHash().put(key, "currentProductId", productId);
        redisTemplate.opsForHash().put(key, "currentProductPrice", price);
        redisTemplate.opsForHash().put(key, "lastActivity", System.currentTimeMillis());
        
        // é‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´
        redisTemplate.expire(key, CONTEXT_TTL_MINUTES, TimeUnit.MINUTES);
    }
    
    public void incrementPromotionAttempts(String sessionId) {
        String key = CONTEXT_PREFIX + sessionId;
        redisTemplate.opsForHash().increment(key, "promotionAttempts", 1);
    }
    
    private Map<String, Object> buildContextMap(ChatContext context) {
        Map<String, Object> map = new HashMap<>();
        map.put("sessionId", context.getSessionId());
        map.put("userId", context.getUserId());
        map.put("currentProductId", context.getCurrentProductId());
        map.put("currentProductPrice", context.getCurrentProductPrice());
        map.put("currentIntent", context.getCurrentIntent());
        map.put("promotionAttempts", context.getPromotionAttempts());
        map.put("creditCardPromoted", context.isCreditCardPromoted());
        map.put("lastActivity", System.currentTimeMillis());
        return map;
    }
}
```

#### 4.2.3 ç”¨æˆ·ä¿¡ç”¨å¡ä¿¡æ¯ç¼“å­˜æœåŠ¡

```java
@Service
public class UserCreditCardCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private UserCreditCardRepository cardRepository;
    
    private static final String USER_CARD_PREFIX = "user_card:";
    private static final int CARD_CACHE_TTL_MINUTES = 10;
    
    public UserCreditCard getUserCreditCard(Long userId) {
        String key = USER_CARD_PREFIX + userId;
        
        // å…ˆä»ç¼“å­˜è·å–
        UserCreditCard cachedCard = (UserCreditCard) redisTemplate.opsForValue().get(key);
        if (cachedCard != null) {
            return cachedCard;
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“æŸ¥è¯¢
        UserCreditCard dbCard = cardRepository.findByUserId(userId);
        if (dbCard != null) {
            // ç¼“å­˜åˆ°Redis
            redisTemplate.opsForValue().set(key, dbCard, CARD_CACHE_TTL_MINUTES, TimeUnit.MINUTES);
        }
        
        return dbCard;
    }
    
    public void updateUserCard(UserCreditCard userCard) {
        // æ›´æ–°æ•°æ®åº“
        cardRepository.save(userCard);
        
        // æ›´æ–°ç¼“å­˜
        String key = USER_CARD_PREFIX + userCard.getUserId();
        redisTemplate.opsForValue().set(key, userCard, CARD_CACHE_TTL_MINUTES, TimeUnit.MINUTES);
    }
    
    public void invalidateUserCard(Long userId) {
        String key = USER_CARD_PREFIX + userId;
        redisTemplate.delete(key);
    }
}
```

## äº”ã€å¼€å‘ä»»åŠ¡åˆ†è§£

### 5.1 Phase 1ï¼šåŸºç¡€æ¡†æ¶æ­å»ºï¼ˆ3å¤©ï¼‰

#### åç«¯ä»»åŠ¡ï¼š

1. **åˆ›å»ºå®¢æœæ¨¡å—åŸºç¡€ç»“æ„**
   - åˆ›å»ºcontrollerã€serviceã€entityåŒ…
   - è®¾è®¡åŸºç¡€çš„å¯¹è¯ç®¡ç†ç±»
   - é…ç½®AIæœåŠ¡å®¢æˆ·ç«¯
2. **Redisä¸­é—´ä»¶é›†æˆ**
   - æ·»åŠ Spring Boot Redisä¾èµ–
   - é…ç½®Redisè¿æ¥å‚æ•°
   - åˆ›å»ºRedisTemplateé…ç½®ç±»
   - å®ç°åŸºç¡€ç¼“å­˜æœåŠ¡ç±»
3. **æ•°æ®åº“è¡¨åˆ›å»º**
   - æ‰§è¡ŒDDLè„šæœ¬åˆ›å»ºæ–°è¡¨
   - åˆå§‹åŒ–FAQçŸ¥è¯†åº“æ•°æ®
   - åˆ›å»ºæµ‹è¯•ç”¨æˆ·ä¿¡ç”¨å¡æ•°æ®
   - æ·»åŠ ç¼“å­˜ç›¸å…³å­—æ®µ
4. **æ ¸å¿ƒæ¥å£å¼€å‘**
   - å®ç°èŠå¤©æ¶ˆæ¯å‘é€æ¥å£
   - å®ç°ç”¨æˆ·ä¿¡ç”¨å¡ä¿¡æ¯æŸ¥è¯¢æ¥å£ï¼ˆå«ç¼“å­˜ï¼‰
   - æ·»åŠ åŸºæœ¬çš„å¼‚å¸¸å¤„ç†
   - é›†æˆRedisç¼“å­˜æ£€æŸ¥

#### å‰ç«¯ä»»åŠ¡ï¼š

1. **å®¢æœèŠå¤©ç»„ä»¶å¼€å‘**
   - åˆ›å»ºèŠå¤©çª—å£ç»„ä»¶
   - å®ç°æ¶ˆæ¯å‘é€å’Œå±•ç¤º
   - æ·»åŠ æ‰“å­—æœºæ•ˆæœ
   - æ˜¾ç¤ºç¼“å­˜å‘½ä¸­çŠ¶æ€ï¼ˆå¼€å‘è°ƒè¯•ç”¨ï¼‰
2. **é›†æˆåˆ°ç°æœ‰é¡µé¢**
   - åœ¨å•†å“è¯¦æƒ…é¡µæ·»åŠ å®¢æœå…¥å£
   - åœ¨æ”¯ä»˜é¡µé¢æ·»åŠ å®¢æœæŒ‰é’®
   - å®ç°å®¢æœçª—å£çš„æ˜¾ç¤º/éšè—
   - ä¼ é€’å•†å“ä¸Šä¸‹æ–‡ä¿¡æ¯

### 5.2 Phase 2ï¼šAIåŠŸèƒ½é›†æˆä¸ç¼“å­˜ä¼˜åŒ–ï¼ˆ4å¤©ï¼‰

#### åç«¯ä»»åŠ¡ï¼š

1. **æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿå®ç°**
   - å®ç°AIå“åº”ç¼“å­˜é€»è¾‘
   - å¼€å‘ç¼“å­˜keyç”Ÿæˆç­–ç•¥
   - æ·»åŠ ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡
   - å®ç°ç¼“å­˜é¢„çƒ­æœºåˆ¶
2. **å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†**
   - å®ç°ä¼šè¯çŠ¶æ€æŒä¹…åŒ–ï¼ˆRedisï¼‰
   - å¼€å‘ä¸Šä¸‹æ–‡æ™ºèƒ½å…³è”ç®—æ³•
   - æ·»åŠ ä¼šè¯è¶…æ—¶ç®¡ç†
   - å®ç°è·¨é¡µé¢ä¸Šä¸‹æ–‡ä¼ é€’
3. **æ„å›¾è¯†åˆ«ä¸å“åº”ç”Ÿæˆ**
   - é›†æˆé€šä¹‰åƒé—®API
   - å®ç°åŸºæœ¬æ„å›¾åˆ†ç±»ï¼ˆå¸¦ç¼“å­˜ï¼‰
   - å»ºç«‹æ„å›¾ä¸å›å¤çš„æ˜ å°„å…³ç³»
4. **ä¿¡ç”¨å¡æ¨å¹¿å¼•æ“**
   - å®ç°æƒç›Šè®¡ç®—é€»è¾‘
   - å¼€å‘ä¸ªæ€§åŒ–æ¨å¹¿å†…å®¹ç”Ÿæˆ
   - æ·»åŠ å¿ƒç†æ¿€åŠ±ç­–ç•¥
   - å®ç°æ¨å¹¿é¢‘æ¬¡æ§åˆ¶ï¼ˆRedisè®¡æ•°ï¼‰
5. **çŸ¥è¯†åº“ç®¡ç†**
   - å¯¼å…¥å¸¸è§FAQæ•°æ®
   - å®ç°æ¨¡ç³ŠåŒ¹é…æœç´¢ï¼ˆå¸¦ç¼“å­˜ï¼‰
   - æ·»åŠ ä¿¡ç”¨å¡ç›¸å…³é—®ç­”
   - å®ç°çƒ­é—¨é—®é¢˜ç»Ÿè®¡

#### å‰ç«¯ä»»åŠ¡ï¼š

1. **å¢å¼ºèŠå¤©ä½“éªŒ**
   - æ·»åŠ å¿«æ·å›å¤æŒ‰é’®
   - å®ç°ä¿¡ç”¨å¡æƒç›Šå±•ç¤ºç»„ä»¶
   - æ·»åŠ æ”¯ä»˜æ–¹å¼å¯¹æ¯”å±•ç¤º
   - æ˜¾ç¤ºå“åº”æ—¶é—´ä¼˜åŒ–æ•ˆæœ
2. **ä¸Šä¸‹æ–‡æ„ŸçŸ¥ä¼˜åŒ–**
   - ä¼ é€’å½“å‰é¡µé¢ä¿¡æ¯
   - ä¼ é€’å•†å“ä¿¡æ¯ç»™å®¢æœ
   - å®ç°è´­ç‰©è½¦ä¿¡æ¯åŒæ­¥
   - æ·»åŠ ä¼šè¯æ¢å¤åŠŸèƒ½

### 5.3 Phase 3ï¼šæ€§èƒ½ä¼˜åŒ–ä¸ç›‘æ§ï¼ˆ3å¤©ï¼‰

#### åç«¯ä»»åŠ¡ï¼š

1. **ç¼“å­˜æ€§èƒ½ä¼˜åŒ–**
   - ä¼˜åŒ–ç¼“å­˜ç­–ç•¥å’ŒTTLè®¾ç½®
   - å®ç°ç¼“å­˜é¢„åŠ è½½
   - æ·»åŠ ç¼“å­˜é™çº§æœºåˆ¶
   - å®ç°åˆ†å¸ƒå¼ç¼“å­˜ä¸€è‡´æ€§
2. **ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–**
   - æ·»åŠ Redisè¿æ¥æ± ä¼˜åŒ–
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
   - æ·»åŠ é™æµä¿æŠ¤
   - å®ç°å¼‚æ­¥å¤„ç†æœºåˆ¶
3. **ç›‘æ§ä¸ç»Ÿè®¡**
   - æ·»åŠ Redisç›‘æ§æŒ‡æ ‡
   - å®ç°ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡
   - æ·»åŠ å¯¹è¯æ•ˆæœç»Ÿè®¡
   - å®ç°ä¿¡ç”¨å¡æ¨å¹¿è½¬åŒ–ç‡ç»Ÿè®¡
   - æ·»åŠ ç”¨æˆ·è¡Œä¸ºåˆ†æ
4. **æ•°æ®åˆ†æåŠŸèƒ½**
   - å®ç°ç”¨æˆ·ç”»åƒæ›´æ–°ï¼ˆRedisï¼‰
   - æ·»åŠ çƒ­é—¨é—®é¢˜åˆ†æ
   - å®ç°A/Bæµ‹è¯•æ•°æ®æ”¶é›†
   - å¼€å‘æ¨å¹¿æ•ˆæœdashboard

#### å‰ç«¯ä»»åŠ¡ï¼š

1. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - æ·»åŠ loadingçŠ¶æ€ä¼˜åŒ–
   - ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º
   - æ·»åŠ å®¢æœæ»¡æ„åº¦è¯„ä»·
   - å®ç°ç¦»çº¿æ¶ˆæ¯ç¼“å­˜
2. **æµ‹è¯•ä¸è°ƒè¯•**
   - å®Œæ•´åŠŸèƒ½æµ‹è¯•
   - ç¼“å­˜ä¸€è‡´æ€§æµ‹è¯•
   - è¾¹ç•Œæƒ…å†µå¤„ç†
   - æ€§èƒ½å‹åŠ›æµ‹è¯•

## å…­ã€æˆåŠŸæŒ‡æ ‡

### 6.1 æŠ€æœ¯æŒ‡æ ‡

- å®¢æœå“åº”æ—¶é—´ < 1ç§’ï¼ˆç¼“å­˜å‘½ä¸­æ—¶ < 200msï¼‰
- Redisç¼“å­˜å‘½ä¸­ç‡ > 60%
- AI APIè°ƒç”¨å‡å°‘ > 50%
- æ„å›¾è¯†åˆ«å‡†ç¡®ç‡ > 85%
- ç³»ç»Ÿå¯ç”¨æ€§ > 99%
- Rediså†…å­˜ä½¿ç”¨ç‡ < 80%

## ä¸ƒã€é£é™©æ§åˆ¶

### 7.1 æŠ€æœ¯é£é™©

- **RedisæœåŠ¡å¼‚å¸¸**ï¼šå®ç°æœ¬åœ°ç¼“å­˜é™çº§ï¼Œç¡®ä¿åŸºç¡€åŠŸèƒ½å¯ç”¨
- **ç¼“å­˜æ•°æ®ä¸ä¸€è‡´**ï¼šå»ºç«‹ç¼“å­˜æ›´æ–°æœºåˆ¶ï¼Œå®šæœŸåŒæ­¥æ•°æ®
- **å“åº”æ—¶é—´è¿‡é•¿**ï¼šæ·»åŠ å¤šçº§ç¼“å­˜æœºåˆ¶ï¼Œé¢„ç½®å¸¸è§å›å¤
- **æ„å›¾è¯†åˆ«é”™è¯¯**ï¼šå»ºç«‹äººå·¥å¹²é¢„æœºåˆ¶
- **å†…å­˜ä½¿ç”¨è¿‡é«˜**ï¼šç›‘æ§Rediså†…å­˜ï¼Œå®ç°ç¼“å­˜æ¸…ç†ç­–ç•¥

## ä¹ã€Redisé›†æˆå®æ–½æŒ‡å—

### 9.1 ä¾èµ–é…ç½®

```xml
<!-- pom.xml -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-pool2</artifactId>
</dependency>
```

### 9.2 Redisé…ç½®ç±»

```java
@Configuration
@EnableCaching
public class RedisConfig {
    
    @Bean
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(factory);
        
        // è®¾ç½®åºåˆ—åŒ–å™¨
        template.setKeySerializer(new StringRedisSerializer());
        template.setValueSerializer(new GenericJackson2JsonRedisSerializer());
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new GenericJackson2JsonRedisSerializer());
        
        template.afterPropertiesSet();
        return template;
    }
    
    @Bean
    public CacheManager cacheManager(RedisConnectionFactory factory) {
        RedisCacheManager.Builder builder = RedisCacheManager
            .RedisCacheManagerBuilder
            .fromConnectionFactory(factory)
            .cacheDefaults(cacheConfiguration());
        
        return builder.build();
    }
    
    private RedisCacheConfiguration cacheConfiguration() {
        return RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(30))
            .serializeKeysWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new StringRedisSerializer()))
            .serializeValuesWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new GenericJackson2JsonRedisSerializer()));
    }
}
```

### 9.3 ç¼“å­˜ä½¿ç”¨ç¤ºä¾‹

```java
@Service
public class CustomerServiceService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // ä½¿ç”¨æ³¨è§£å¼ç¼“å­˜
    @Cacheable(value = "ai_responses", key = "#question.hashCode()")
    public String getAIResponse(String question) {
        return callAIAPI(question);
    }
    
    // æ‰‹åŠ¨ç¼“å­˜æ“ä½œ
    public ChatContext getOrCreateContext(String sessionId) {
        String key = "chat_context:" + sessionId;
        ChatContext context = (ChatContext) redisTemplate.opsForValue().get(key);
        
        if (context == null) {
            context = new ChatContext(sessionId);
            redisTemplate.opsForValue().set(key, context, 30, TimeUnit.MINUTES);
        }
        
        return context;
    }
    
    // ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡
    public void trackUserBehavior(Long userId, String action) {
        String key = "user_behavior:" + userId + ":" + LocalDate.now();
        redisTemplate.opsForHash().increment(key, action, 1);
        redisTemplate.expire(key, 7, TimeUnit.DAYS);
    }
}
```

### 9.4 ç›‘æ§ä¸ç»´æŠ¤

```java
@Component
public class RedisMonitor {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    public void monitorRedisHealth() {
        try {
            redisTemplate.opsForValue().get("health_check");
            log.info("Rediså¥åº·æ£€æŸ¥é€šè¿‡");
        } catch (Exception e) {
            log.error("Redisè¿æ¥å¼‚å¸¸: {}", e.getMessage());
            // è§¦å‘å‘Šè­¦
        }
    }
    
    public Map<String, Object> getCacheStats() {
        Map<String, Object> stats = new HashMap<>();
        
        // è·å–Redisä¿¡æ¯
        Properties info = redisTemplate.getConnectionFactory()
            .getConnection().info("memory");
        
        stats.put("usedMemory", info.getProperty("used_memory_human"));
        stats.put("maxMemory", info.getProperty("maxmemory_human"));
        
        return stats;
    }
}
```

