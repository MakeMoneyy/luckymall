{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport { OrderService } from '../../services/orderService';\n\n// 模拟用户ID\nconst MOCK_USER_ID = 1;\n\n// 异步action：创建订单\nexport const createOrderAsync = createAsyncThunk('order/createOrder', async (request, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await OrderService.createOrder(MOCK_USER_ID, request);\n    return response;\n  } catch (error) {\n    return rejectWithValue('创建订单失败');\n  }\n});\n\n// 异步action：获取用户订单列表\nexport const fetchUserOrdersAsync = createAsyncThunk('order/fetchUserOrders', async (_, {\n  rejectWithValue\n}) => {\n  try {\n    const orders = await OrderService.getOrdersByUserId(MOCK_USER_ID);\n    return orders;\n  } catch (error) {\n    return rejectWithValue('获取订单列表失败');\n  }\n});\n\n// 异步action：取消订单\nexport const cancelOrderAsync = createAsyncThunk('order/cancelOrder', async (orderId, {\n  rejectWithValue\n}) => {\n  try {\n    await OrderService.cancelOrder(orderId, MOCK_USER_ID);\n    return orderId;\n  } catch (error) {\n    return rejectWithValue('取消订单失败');\n  }\n});\n\n// 异步action：确认收货\nexport const confirmReceiveAsync = createAsyncThunk('order/confirmReceive', async (orderId, {\n  rejectWithValue\n}) => {\n  try {\n    await OrderService.confirmReceive(orderId, MOCK_USER_ID);\n    return orderId;\n  } catch (error) {\n    return rejectWithValue('确认收货失败');\n  }\n});\nconst initialState = {\n  orders: [],\n  currentOrder: null,\n  loading: false,\n  error: null\n};\nconst orderSlice = createSlice({\n  name: 'order',\n  initialState,\n  reducers: {\n    clearCurrentOrder: state => {\n      state.currentOrder = null;\n    },\n    // 添加订单到本地存储（用于模拟）\n    addLocalOrder: (state, action) => {\n      state.orders.unshift(action.payload);\n    }\n  },\n  extraReducers: builder => {\n    builder\n    // 创建订单\n    .addCase(createOrderAsync.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(createOrderAsync.fulfilled, (state, action) => {\n      state.loading = false;\n      state.currentOrder = action.payload;\n    }).addCase(createOrderAsync.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    })\n\n    // 获取用户订单列表\n    .addCase(fetchUserOrdersAsync.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(fetchUserOrdersAsync.fulfilled, (state, action) => {\n      state.loading = false;\n      state.orders = action.payload;\n    }).addCase(fetchUserOrdersAsync.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    })\n\n    // 取消订单\n    .addCase(cancelOrderAsync.fulfilled, (state, action) => {\n      const orderId = action.payload;\n      const orderIndex = state.orders.findIndex(order => Number(order.id) === orderId);\n      if (orderIndex !== -1) {\n        state.orders[orderIndex].status = 'CANCELLED';\n      }\n    })\n\n    // 确认收货\n    .addCase(confirmReceiveAsync.fulfilled, (state, action) => {\n      const orderId = action.payload;\n      const orderIndex = state.orders.findIndex(order => Number(order.id) === orderId);\n      if (orderIndex !== -1) {\n        state.orders[orderIndex].status = 'COMPLETED';\n      }\n    });\n  }\n});\nexport const {\n  clearCurrentOrder,\n  addLocalOrder\n} = orderSlice.actions;\nexport default orderSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","OrderService","MOCK_USER_ID","createOrderAsync","request","rejectWithValue","response","createOrder","error","fetchUserOrdersAsync","_","orders","getOrdersByUserId","cancelOrderAsync","orderId","cancelOrder","confirmReceiveAsync","confirmReceive","initialState","currentOrder","loading","orderSlice","name","reducers","clearCurrentOrder","state","addLocalOrder","action","unshift","payload","extraReducers","builder","addCase","pending","fulfilled","rejected","orderIndex","findIndex","order","Number","id","status","actions","reducer"],"sources":["D:/luckymall/frontend/src/store/slices/orderSlice.ts"],"sourcesContent":["import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\r\nimport { Order } from '../../types';\r\nimport { OrderService, CreateOrderRequest, CreateOrderResponse } from '../../services/orderService';\r\n\r\n// 模拟用户ID\r\nconst MOCK_USER_ID = 1;\r\n\r\n// 异步action：创建订单\r\nexport const createOrderAsync = createAsyncThunk(\r\n  'order/createOrder',\r\n  async (request: CreateOrderRequest, { rejectWithValue }) => {\r\n    try {\r\n      const response = await OrderService.createOrder(MOCK_USER_ID, request);\r\n      return response;\r\n    } catch (error) {\r\n      return rejectWithValue('创建订单失败');\r\n    }\r\n  }\r\n);\r\n\r\n// 异步action：获取用户订单列表\r\nexport const fetchUserOrdersAsync = createAsyncThunk(\r\n  'order/fetchUserOrders',\r\n  async (_, { rejectWithValue }) => {\r\n    try {\r\n      const orders = await OrderService.getOrdersByUserId(MOCK_USER_ID);\r\n      return orders;\r\n    } catch (error) {\r\n      return rejectWithValue('获取订单列表失败');\r\n    }\r\n  }\r\n);\r\n\r\n// 异步action：取消订单\r\nexport const cancelOrderAsync = createAsyncThunk(\r\n  'order/cancelOrder',\r\n  async (orderId: number, { rejectWithValue }) => {\r\n    try {\r\n      await OrderService.cancelOrder(orderId, MOCK_USER_ID);\r\n      return orderId;\r\n    } catch (error) {\r\n      return rejectWithValue('取消订单失败');\r\n    }\r\n  }\r\n);\r\n\r\n// 异步action：确认收货\r\nexport const confirmReceiveAsync = createAsyncThunk(\r\n  'order/confirmReceive',\r\n  async (orderId: number, { rejectWithValue }) => {\r\n    try {\r\n      await OrderService.confirmReceive(orderId, MOCK_USER_ID);\r\n      return orderId;\r\n    } catch (error) {\r\n      return rejectWithValue('确认收货失败');\r\n    }\r\n  }\r\n);\r\n\r\ninterface OrderState {\r\n  orders: Order[];\r\n  currentOrder: CreateOrderResponse | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n}\r\n\r\nconst initialState: OrderState = {\r\n  orders: [],\r\n  currentOrder: null,\r\n  loading: false,\r\n  error: null\r\n};\r\n\r\nconst orderSlice = createSlice({\r\n  name: 'order',\r\n  initialState,\r\n  reducers: {\r\n    clearCurrentOrder: (state) => {\r\n      state.currentOrder = null;\r\n    },\r\n    // 添加订单到本地存储（用于模拟）\r\n    addLocalOrder: (state, action: PayloadAction<Order>) => {\r\n      state.orders.unshift(action.payload);\r\n    }\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      // 创建订单\r\n      .addCase(createOrderAsync.pending, (state) => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(createOrderAsync.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.currentOrder = action.payload;\r\n      })\r\n      .addCase(createOrderAsync.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload as string;\r\n      })\r\n      \r\n      // 获取用户订单列表\r\n      .addCase(fetchUserOrdersAsync.pending, (state) => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(fetchUserOrdersAsync.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.orders = action.payload;\r\n      })\r\n      .addCase(fetchUserOrdersAsync.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload as string;\r\n      })\r\n      \r\n      // 取消订单\r\n      .addCase(cancelOrderAsync.fulfilled, (state, action) => {\r\n        const orderId = action.payload;\r\n        const orderIndex = state.orders.findIndex(order => Number(order.id) === orderId);\r\n        if (orderIndex !== -1) {\r\n          state.orders[orderIndex].status = 'CANCELLED';\r\n        }\r\n      })\r\n      \r\n      // 确认收货\r\n      .addCase(confirmReceiveAsync.fulfilled, (state, action) => {\r\n        const orderId = action.payload;\r\n        const orderIndex = state.orders.findIndex(order => Number(order.id) === orderId);\r\n        if (orderIndex !== -1) {\r\n          state.orders[orderIndex].status = 'COMPLETED';\r\n        }\r\n      });\r\n  }\r\n});\r\n\r\nexport const { clearCurrentOrder, addLocalOrder } = orderSlice.actions;\r\n\r\nexport default orderSlice.reducer; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}