{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport { ProductService } from '../../services/productService';\n\n// 异步action：获取商品列表\nexport const fetchProducts = createAsyncThunk('products/fetchProducts', async (params = {}) => {\n  const response = await ProductService.getProducts(params);\n  return response;\n});\n\n// 异步action：获取商品详情\nexport const fetchProductById = createAsyncThunk('products/fetchProductById', async (id, {\n  rejectWithValue\n}) => {\n  try {\n    console.log('开始获取商品详情, ID:', id);\n    const response = await ProductService.getProductById(id);\n    console.log('获取商品详情成功:', response);\n    return response;\n  } catch (error) {\n    console.error('获取商品详情失败:', error);\n    return rejectWithValue(error instanceof Error ? error.message : '未知错误');\n  }\n});\n\n// 异步action：搜索商品\nexport const searchProducts = createAsyncThunk('products/searchProducts', async params => {\n  const response = await ProductService.searchProducts(params);\n  return response;\n});\nconst initialState = {\n  products: [],\n  total: 0,\n  current: 1,\n  size: 10,\n  pages: 0,\n  loading: false,\n  error: null,\n  currentProduct: null,\n  detailLoading: false,\n  detailError: null,\n  searchResults: [],\n  searchTotal: 0,\n  searchCurrent: 1,\n  searchLoading: false,\n  searchError: null,\n  lastSearchKeyword: '',\n  filters: {}\n};\nconst productSlice = createSlice({\n  name: 'products',\n  initialState,\n  reducers: {\n    // 设置筛选条件\n    setFilters: (state, action) => {\n      state.filters = {\n        ...state.filters,\n        ...action.payload\n      };\n    },\n    // 清除筛选条件\n    clearFilters: state => {\n      state.filters = {};\n    },\n    // 重置搜索结果\n    resetSearch: state => {\n      state.searchResults = [];\n      state.searchTotal = 0;\n      state.searchCurrent = 1;\n      state.searchError = null;\n      state.lastSearchKeyword = '';\n    },\n    // 重置当前商品详情\n    resetCurrentProduct: state => {\n      state.currentProduct = null;\n      state.detailError = null;\n    }\n  },\n  extraReducers: builder => {\n    // 获取商品列表\n    builder.addCase(fetchProducts.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(fetchProducts.fulfilled, (state, action) => {\n      state.loading = false;\n      state.products = action.payload.records;\n      state.total = action.payload.total;\n      state.current = action.payload.current;\n      state.size = action.payload.size;\n      state.pages = action.payload.pages;\n    }).addCase(fetchProducts.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.error.message || '获取商品列表失败';\n    });\n\n    // 获取商品详情\n    builder.addCase(fetchProductById.pending, state => {\n      state.detailLoading = true;\n      state.detailError = null;\n    }).addCase(fetchProductById.fulfilled, (state, action) => {\n      state.detailLoading = false;\n      state.currentProduct = action.payload;\n    }).addCase(fetchProductById.rejected, (state, action) => {\n      state.detailLoading = false;\n      state.detailError = action.error.message || '获取商品详情失败';\n    });\n\n    // 搜索商品\n    builder.addCase(searchProducts.pending, state => {\n      state.searchLoading = true;\n      state.searchError = null;\n    }).addCase(searchProducts.fulfilled, (state, action) => {\n      state.searchLoading = false;\n      state.searchResults = action.payload.records;\n      state.searchTotal = action.payload.total;\n      state.searchCurrent = action.payload.current;\n    }).addCase(searchProducts.rejected, (state, action) => {\n      state.searchLoading = false;\n      state.searchError = action.error.message || '搜索商品失败';\n    });\n  }\n});\nexport const {\n  setFilters,\n  clearFilters,\n  resetSearch,\n  resetCurrentProduct\n} = productSlice.actions;\nexport default productSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","ProductService","fetchProducts","params","response","getProducts","fetchProductById","id","rejectWithValue","console","log","getProductById","error","Error","message","searchProducts","initialState","products","total","current","size","pages","loading","currentProduct","detailLoading","detailError","searchResults","searchTotal","searchCurrent","searchLoading","searchError","lastSearchKeyword","filters","productSlice","name","reducers","setFilters","state","action","payload","clearFilters","resetSearch","resetCurrentProduct","extraReducers","builder","addCase","pending","fulfilled","records","rejected","actions","reducer"],"sources":["D:/luckymall/frontend/src/store/slices/productSlice.ts"],"sourcesContent":["import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\r\nimport { Product, PageResult, ProductQueryParams, ProductSearchParams } from '../../types';\r\nimport { ProductService } from '../../services/productService';\r\n\r\n// 异步action：获取商品列表\r\nexport const fetchProducts = createAsyncThunk(\r\n  'products/fetchProducts',\r\n  async (params: ProductQueryParams = {}) => {\r\n    const response = await ProductService.getProducts(params);\r\n    return response;\r\n  }\r\n);\r\n\r\n// 异步action：获取商品详情\r\nexport const fetchProductById = createAsyncThunk(\r\n  'products/fetchProductById',\r\n  async (id: number, { rejectWithValue }) => {\r\n    try {\r\n      console.log('开始获取商品详情, ID:', id);\r\n      const response = await ProductService.getProductById(id);\r\n      console.log('获取商品详情成功:', response);\r\n      return response;\r\n    } catch (error) {\r\n      console.error('获取商品详情失败:', error);\r\n      return rejectWithValue(error instanceof Error ? error.message : '未知错误');\r\n    }\r\n  }\r\n);\r\n\r\n// 异步action：搜索商品\r\nexport const searchProducts = createAsyncThunk(\r\n  'products/searchProducts',\r\n  async (params: ProductSearchParams) => {\r\n    const response = await ProductService.searchProducts(params);\r\n    return response;\r\n  }\r\n);\r\n\r\ninterface ProductState {\r\n  // 商品列表相关\r\n  products: Product[];\r\n  total: number;\r\n  current: number;\r\n  size: number;\r\n  pages: number;\r\n  loading: boolean;\r\n  error: string | null;\r\n  \r\n  // 商品详情相关\r\n  currentProduct: Product | null;\r\n  detailLoading: boolean;\r\n  detailError: string | null;\r\n  \r\n  // 搜索相关\r\n  searchResults: Product[];\r\n  searchTotal: number;\r\n  searchCurrent: number;\r\n  searchLoading: boolean;\r\n  searchError: string | null;\r\n  lastSearchKeyword: string;\r\n  \r\n  // 筛选条件\r\n  filters: {\r\n    categoryId?: number;\r\n    minPrice?: number;\r\n    maxPrice?: number;\r\n    sortBy?: string;\r\n  };\r\n}\r\n\r\nconst initialState: ProductState = {\r\n  products: [],\r\n  total: 0,\r\n  current: 1,\r\n  size: 10,\r\n  pages: 0,\r\n  loading: false,\r\n  error: null,\r\n  \r\n  currentProduct: null,\r\n  detailLoading: false,\r\n  detailError: null,\r\n  \r\n  searchResults: [],\r\n  searchTotal: 0,\r\n  searchCurrent: 1,\r\n  searchLoading: false,\r\n  searchError: null,\r\n  lastSearchKeyword: '',\r\n  \r\n  filters: {},\r\n};\r\n\r\nconst productSlice = createSlice({\r\n  name: 'products',\r\n  initialState,\r\n  reducers: {\r\n    // 设置筛选条件\r\n    setFilters: (state, action: PayloadAction<Partial<ProductState['filters']>>) => {\r\n      state.filters = { ...state.filters, ...action.payload };\r\n    },\r\n    \r\n    // 清除筛选条件\r\n    clearFilters: (state) => {\r\n      state.filters = {};\r\n    },\r\n    \r\n    // 重置搜索结果\r\n    resetSearch: (state) => {\r\n      state.searchResults = [];\r\n      state.searchTotal = 0;\r\n      state.searchCurrent = 1;\r\n      state.searchError = null;\r\n      state.lastSearchKeyword = '';\r\n    },\r\n    \r\n    // 重置当前商品详情\r\n    resetCurrentProduct: (state) => {\r\n      state.currentProduct = null;\r\n      state.detailError = null;\r\n    },\r\n  },\r\n  extraReducers: (builder) => {\r\n    // 获取商品列表\r\n    builder\r\n      .addCase(fetchProducts.pending, (state) => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(fetchProducts.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.products = action.payload.records;\r\n        state.total = action.payload.total;\r\n        state.current = action.payload.current;\r\n        state.size = action.payload.size;\r\n        state.pages = action.payload.pages;\r\n      })\r\n      .addCase(fetchProducts.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.error.message || '获取商品列表失败';\r\n      });\r\n    \r\n    // 获取商品详情\r\n    builder\r\n      .addCase(fetchProductById.pending, (state) => {\r\n        state.detailLoading = true;\r\n        state.detailError = null;\r\n      })\r\n      .addCase(fetchProductById.fulfilled, (state, action) => {\r\n        state.detailLoading = false;\r\n        state.currentProduct = action.payload;\r\n      })\r\n      .addCase(fetchProductById.rejected, (state, action) => {\r\n        state.detailLoading = false;\r\n        state.detailError = action.error.message || '获取商品详情失败';\r\n      });\r\n    \r\n    // 搜索商品\r\n    builder\r\n      .addCase(searchProducts.pending, (state) => {\r\n        state.searchLoading = true;\r\n        state.searchError = null;\r\n      })\r\n      .addCase(searchProducts.fulfilled, (state, action) => {\r\n        state.searchLoading = false;\r\n        state.searchResults = action.payload.records;\r\n        state.searchTotal = action.payload.total;\r\n        state.searchCurrent = action.payload.current;\r\n      })\r\n      .addCase(searchProducts.rejected, (state, action) => {\r\n        state.searchLoading = false;\r\n        state.searchError = action.error.message || '搜索商品失败';\r\n      });\r\n  },\r\n});\r\n\r\nexport const { \r\n  setFilters, \r\n  clearFilters, \r\n  resetSearch, \r\n  resetCurrentProduct \r\n} = productSlice.actions;\r\n\r\nexport default productSlice.reducer; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}