{"ast":null,"code":"import{createSlice,createAsyncThunk}from'@reduxjs/toolkit';import{ProductService}from'../../services/productService';// 异步action：获取商品列表\nexport const fetchProducts=createAsyncThunk('products/fetchProducts',async function(){let params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const response=await ProductService.getProducts(params);return response;});// 异步action：获取商品详情\nexport const fetchProductById=createAsyncThunk('products/fetchProductById',async id=>{const response=await ProductService.getProductById(id);return response;});// 异步action：搜索商品\nexport const searchProducts=createAsyncThunk('products/searchProducts',async params=>{const response=await ProductService.searchProducts(params);return response;});const initialState={products:[],total:0,current:1,size:10,pages:0,loading:false,error:null,currentProduct:null,detailLoading:false,detailError:null,searchResults:[],searchTotal:0,searchCurrent:1,searchLoading:false,searchError:null,lastSearchKeyword:'',filters:{}};const productSlice=createSlice({name:'products',initialState,reducers:{// 设置筛选条件\nsetFilters:(state,action)=>{state.filters={...state.filters,...action.payload};},// 清除筛选条件\nclearFilters:state=>{state.filters={};},// 重置搜索结果\nresetSearch:state=>{state.searchResults=[];state.searchTotal=0;state.searchCurrent=1;state.searchError=null;state.lastSearchKeyword='';},// 重置当前商品详情\nresetCurrentProduct:state=>{state.currentProduct=null;state.detailError=null;}},extraReducers:builder=>{// 获取商品列表\nbuilder.addCase(fetchProducts.pending,state=>{state.loading=true;state.error=null;}).addCase(fetchProducts.fulfilled,(state,action)=>{state.loading=false;state.products=action.payload.records;state.total=action.payload.total;state.current=action.payload.current;state.size=action.payload.size;state.pages=action.payload.pages;}).addCase(fetchProducts.rejected,(state,action)=>{state.loading=false;state.error=action.error.message||'获取商品列表失败';});// 获取商品详情\nbuilder.addCase(fetchProductById.pending,state=>{state.detailLoading=true;state.detailError=null;}).addCase(fetchProductById.fulfilled,(state,action)=>{state.detailLoading=false;state.currentProduct=action.payload;}).addCase(fetchProductById.rejected,(state,action)=>{state.detailLoading=false;state.detailError=action.error.message||'获取商品详情失败';});// 搜索商品\nbuilder.addCase(searchProducts.pending,state=>{state.searchLoading=true;state.searchError=null;}).addCase(searchProducts.fulfilled,(state,action)=>{state.searchLoading=false;state.searchResults=action.payload.records;state.searchTotal=action.payload.total;state.searchCurrent=action.payload.current;}).addCase(searchProducts.rejected,(state,action)=>{state.searchLoading=false;state.searchError=action.error.message||'搜索商品失败';});}});export const{setFilters,clearFilters,resetSearch,resetCurrentProduct}=productSlice.actions;export default productSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","ProductService","fetchProducts","params","arguments","length","undefined","response","getProducts","fetchProductById","id","getProductById","searchProducts","initialState","products","total","current","size","pages","loading","error","currentProduct","detailLoading","detailError","searchResults","searchTotal","searchCurrent","searchLoading","searchError","lastSearchKeyword","filters","productSlice","name","reducers","setFilters","state","action","payload","clearFilters","resetSearch","resetCurrentProduct","extraReducers","builder","addCase","pending","fulfilled","records","rejected","message","actions","reducer"],"sources":["D:/luckymall/frontend/src/store/slices/productSlice.ts"],"sourcesContent":["import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\r\nimport { Product, PageResult, ProductQueryParams, ProductSearchParams } from '../../types';\r\nimport { ProductService } from '../../services/productService';\r\n\r\n// 异步action：获取商品列表\r\nexport const fetchProducts = createAsyncThunk(\r\n  'products/fetchProducts',\r\n  async (params: ProductQueryParams = {}) => {\r\n    const response = await ProductService.getProducts(params);\r\n    return response;\r\n  }\r\n);\r\n\r\n// 异步action：获取商品详情\r\nexport const fetchProductById = createAsyncThunk(\r\n  'products/fetchProductById',\r\n  async (id: number) => {\r\n    const response = await ProductService.getProductById(id);\r\n    return response;\r\n  }\r\n);\r\n\r\n// 异步action：搜索商品\r\nexport const searchProducts = createAsyncThunk(\r\n  'products/searchProducts',\r\n  async (params: ProductSearchParams) => {\r\n    const response = await ProductService.searchProducts(params);\r\n    return response;\r\n  }\r\n);\r\n\r\ninterface ProductState {\r\n  // 商品列表相关\r\n  products: Product[];\r\n  total: number;\r\n  current: number;\r\n  size: number;\r\n  pages: number;\r\n  loading: boolean;\r\n  error: string | null;\r\n  \r\n  // 商品详情相关\r\n  currentProduct: Product | null;\r\n  detailLoading: boolean;\r\n  detailError: string | null;\r\n  \r\n  // 搜索相关\r\n  searchResults: Product[];\r\n  searchTotal: number;\r\n  searchCurrent: number;\r\n  searchLoading: boolean;\r\n  searchError: string | null;\r\n  lastSearchKeyword: string;\r\n  \r\n  // 筛选条件\r\n  filters: {\r\n    categoryId?: number;\r\n    minPrice?: number;\r\n    maxPrice?: number;\r\n    sortBy?: string;\r\n  };\r\n}\r\n\r\nconst initialState: ProductState = {\r\n  products: [],\r\n  total: 0,\r\n  current: 1,\r\n  size: 10,\r\n  pages: 0,\r\n  loading: false,\r\n  error: null,\r\n  \r\n  currentProduct: null,\r\n  detailLoading: false,\r\n  detailError: null,\r\n  \r\n  searchResults: [],\r\n  searchTotal: 0,\r\n  searchCurrent: 1,\r\n  searchLoading: false,\r\n  searchError: null,\r\n  lastSearchKeyword: '',\r\n  \r\n  filters: {},\r\n};\r\n\r\nconst productSlice = createSlice({\r\n  name: 'products',\r\n  initialState,\r\n  reducers: {\r\n    // 设置筛选条件\r\n    setFilters: (state, action: PayloadAction<Partial<ProductState['filters']>>) => {\r\n      state.filters = { ...state.filters, ...action.payload };\r\n    },\r\n    \r\n    // 清除筛选条件\r\n    clearFilters: (state) => {\r\n      state.filters = {};\r\n    },\r\n    \r\n    // 重置搜索结果\r\n    resetSearch: (state) => {\r\n      state.searchResults = [];\r\n      state.searchTotal = 0;\r\n      state.searchCurrent = 1;\r\n      state.searchError = null;\r\n      state.lastSearchKeyword = '';\r\n    },\r\n    \r\n    // 重置当前商品详情\r\n    resetCurrentProduct: (state) => {\r\n      state.currentProduct = null;\r\n      state.detailError = null;\r\n    },\r\n  },\r\n  extraReducers: (builder) => {\r\n    // 获取商品列表\r\n    builder\r\n      .addCase(fetchProducts.pending, (state) => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(fetchProducts.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.products = action.payload.records;\r\n        state.total = action.payload.total;\r\n        state.current = action.payload.current;\r\n        state.size = action.payload.size;\r\n        state.pages = action.payload.pages;\r\n      })\r\n      .addCase(fetchProducts.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.error.message || '获取商品列表失败';\r\n      });\r\n    \r\n    // 获取商品详情\r\n    builder\r\n      .addCase(fetchProductById.pending, (state) => {\r\n        state.detailLoading = true;\r\n        state.detailError = null;\r\n      })\r\n      .addCase(fetchProductById.fulfilled, (state, action) => {\r\n        state.detailLoading = false;\r\n        state.currentProduct = action.payload;\r\n      })\r\n      .addCase(fetchProductById.rejected, (state, action) => {\r\n        state.detailLoading = false;\r\n        state.detailError = action.error.message || '获取商品详情失败';\r\n      });\r\n    \r\n    // 搜索商品\r\n    builder\r\n      .addCase(searchProducts.pending, (state) => {\r\n        state.searchLoading = true;\r\n        state.searchError = null;\r\n      })\r\n      .addCase(searchProducts.fulfilled, (state, action) => {\r\n        state.searchLoading = false;\r\n        state.searchResults = action.payload.records;\r\n        state.searchTotal = action.payload.total;\r\n        state.searchCurrent = action.payload.current;\r\n      })\r\n      .addCase(searchProducts.rejected, (state, action) => {\r\n        state.searchLoading = false;\r\n        state.searchError = action.error.message || '搜索商品失败';\r\n      });\r\n  },\r\n});\r\n\r\nexport const { \r\n  setFilters, \r\n  clearFilters, \r\n  resetSearch, \r\n  resetCurrentProduct \r\n} = productSlice.actions;\r\n\r\nexport default productSlice.reducer; "],"mappings":"AAAA,OAASA,WAAW,CAAEC,gBAAgB,KAAuB,kBAAkB,CAE/E,OAASC,cAAc,KAAQ,+BAA+B,CAE9D;AACA,MAAO,MAAM,CAAAC,aAAa,CAAGF,gBAAgB,CAC3C,wBAAwB,CACxB,gBAA2C,IAApC,CAAAG,MAA0B,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,CAAC,CAAC,CACpC,KAAM,CAAAG,QAAQ,CAAG,KAAM,CAAAN,cAAc,CAACO,WAAW,CAACL,MAAM,CAAC,CACzD,MAAO,CAAAI,QAAQ,CACjB,CACF,CAAC,CAED;AACA,MAAO,MAAM,CAAAE,gBAAgB,CAAGT,gBAAgB,CAC9C,2BAA2B,CAC3B,KAAO,CAAAU,EAAU,EAAK,CACpB,KAAM,CAAAH,QAAQ,CAAG,KAAM,CAAAN,cAAc,CAACU,cAAc,CAACD,EAAE,CAAC,CACxD,MAAO,CAAAH,QAAQ,CACjB,CACF,CAAC,CAED;AACA,MAAO,MAAM,CAAAK,cAAc,CAAGZ,gBAAgB,CAC5C,yBAAyB,CACzB,KAAO,CAAAG,MAA2B,EAAK,CACrC,KAAM,CAAAI,QAAQ,CAAG,KAAM,CAAAN,cAAc,CAACW,cAAc,CAACT,MAAM,CAAC,CAC5D,MAAO,CAAAI,QAAQ,CACjB,CACF,CAAC,CAkCD,KAAM,CAAAM,YAA0B,CAAG,CACjCC,QAAQ,CAAE,EAAE,CACZC,KAAK,CAAE,CAAC,CACRC,OAAO,CAAE,CAAC,CACVC,IAAI,CAAE,EAAE,CACRC,KAAK,CAAE,CAAC,CACRC,OAAO,CAAE,KAAK,CACdC,KAAK,CAAE,IAAI,CAEXC,cAAc,CAAE,IAAI,CACpBC,aAAa,CAAE,KAAK,CACpBC,WAAW,CAAE,IAAI,CAEjBC,aAAa,CAAE,EAAE,CACjBC,WAAW,CAAE,CAAC,CACdC,aAAa,CAAE,CAAC,CAChBC,aAAa,CAAE,KAAK,CACpBC,WAAW,CAAE,IAAI,CACjBC,iBAAiB,CAAE,EAAE,CAErBC,OAAO,CAAE,CAAC,CACZ,CAAC,CAED,KAAM,CAAAC,YAAY,CAAGhC,WAAW,CAAC,CAC/BiC,IAAI,CAAE,UAAU,CAChBnB,YAAY,CACZoB,QAAQ,CAAE,CACR;AACAC,UAAU,CAAEA,CAACC,KAAK,CAAEC,MAAuD,GAAK,CAC9ED,KAAK,CAACL,OAAO,CAAG,CAAE,GAAGK,KAAK,CAACL,OAAO,CAAE,GAAGM,MAAM,CAACC,OAAQ,CAAC,CACzD,CAAC,CAED;AACAC,YAAY,CAAGH,KAAK,EAAK,CACvBA,KAAK,CAACL,OAAO,CAAG,CAAC,CAAC,CACpB,CAAC,CAED;AACAS,WAAW,CAAGJ,KAAK,EAAK,CACtBA,KAAK,CAACX,aAAa,CAAG,EAAE,CACxBW,KAAK,CAACV,WAAW,CAAG,CAAC,CACrBU,KAAK,CAACT,aAAa,CAAG,CAAC,CACvBS,KAAK,CAACP,WAAW,CAAG,IAAI,CACxBO,KAAK,CAACN,iBAAiB,CAAG,EAAE,CAC9B,CAAC,CAED;AACAW,mBAAmB,CAAGL,KAAK,EAAK,CAC9BA,KAAK,CAACd,cAAc,CAAG,IAAI,CAC3Bc,KAAK,CAACZ,WAAW,CAAG,IAAI,CAC1B,CACF,CAAC,CACDkB,aAAa,CAAGC,OAAO,EAAK,CAC1B;AACAA,OAAO,CACJC,OAAO,CAACzC,aAAa,CAAC0C,OAAO,CAAGT,KAAK,EAAK,CACzCA,KAAK,CAAChB,OAAO,CAAG,IAAI,CACpBgB,KAAK,CAACf,KAAK,CAAG,IAAI,CACpB,CAAC,CAAC,CACDuB,OAAO,CAACzC,aAAa,CAAC2C,SAAS,CAAE,CAACV,KAAK,CAAEC,MAAM,GAAK,CACnDD,KAAK,CAAChB,OAAO,CAAG,KAAK,CACrBgB,KAAK,CAACrB,QAAQ,CAAGsB,MAAM,CAACC,OAAO,CAACS,OAAO,CACvCX,KAAK,CAACpB,KAAK,CAAGqB,MAAM,CAACC,OAAO,CAACtB,KAAK,CAClCoB,KAAK,CAACnB,OAAO,CAAGoB,MAAM,CAACC,OAAO,CAACrB,OAAO,CACtCmB,KAAK,CAAClB,IAAI,CAAGmB,MAAM,CAACC,OAAO,CAACpB,IAAI,CAChCkB,KAAK,CAACjB,KAAK,CAAGkB,MAAM,CAACC,OAAO,CAACnB,KAAK,CACpC,CAAC,CAAC,CACDyB,OAAO,CAACzC,aAAa,CAAC6C,QAAQ,CAAE,CAACZ,KAAK,CAAEC,MAAM,GAAK,CAClDD,KAAK,CAAChB,OAAO,CAAG,KAAK,CACrBgB,KAAK,CAACf,KAAK,CAAGgB,MAAM,CAAChB,KAAK,CAAC4B,OAAO,EAAI,UAAU,CAClD,CAAC,CAAC,CAEJ;AACAN,OAAO,CACJC,OAAO,CAAClC,gBAAgB,CAACmC,OAAO,CAAGT,KAAK,EAAK,CAC5CA,KAAK,CAACb,aAAa,CAAG,IAAI,CAC1Ba,KAAK,CAACZ,WAAW,CAAG,IAAI,CAC1B,CAAC,CAAC,CACDoB,OAAO,CAAClC,gBAAgB,CAACoC,SAAS,CAAE,CAACV,KAAK,CAAEC,MAAM,GAAK,CACtDD,KAAK,CAACb,aAAa,CAAG,KAAK,CAC3Ba,KAAK,CAACd,cAAc,CAAGe,MAAM,CAACC,OAAO,CACvC,CAAC,CAAC,CACDM,OAAO,CAAClC,gBAAgB,CAACsC,QAAQ,CAAE,CAACZ,KAAK,CAAEC,MAAM,GAAK,CACrDD,KAAK,CAACb,aAAa,CAAG,KAAK,CAC3Ba,KAAK,CAACZ,WAAW,CAAGa,MAAM,CAAChB,KAAK,CAAC4B,OAAO,EAAI,UAAU,CACxD,CAAC,CAAC,CAEJ;AACAN,OAAO,CACJC,OAAO,CAAC/B,cAAc,CAACgC,OAAO,CAAGT,KAAK,EAAK,CAC1CA,KAAK,CAACR,aAAa,CAAG,IAAI,CAC1BQ,KAAK,CAACP,WAAW,CAAG,IAAI,CAC1B,CAAC,CAAC,CACDe,OAAO,CAAC/B,cAAc,CAACiC,SAAS,CAAE,CAACV,KAAK,CAAEC,MAAM,GAAK,CACpDD,KAAK,CAACR,aAAa,CAAG,KAAK,CAC3BQ,KAAK,CAACX,aAAa,CAAGY,MAAM,CAACC,OAAO,CAACS,OAAO,CAC5CX,KAAK,CAACV,WAAW,CAAGW,MAAM,CAACC,OAAO,CAACtB,KAAK,CACxCoB,KAAK,CAACT,aAAa,CAAGU,MAAM,CAACC,OAAO,CAACrB,OAAO,CAC9C,CAAC,CAAC,CACD2B,OAAO,CAAC/B,cAAc,CAACmC,QAAQ,CAAE,CAACZ,KAAK,CAAEC,MAAM,GAAK,CACnDD,KAAK,CAACR,aAAa,CAAG,KAAK,CAC3BQ,KAAK,CAACP,WAAW,CAAGQ,MAAM,CAAChB,KAAK,CAAC4B,OAAO,EAAI,QAAQ,CACtD,CAAC,CAAC,CACN,CACF,CAAC,CAAC,CAEF,MAAO,MAAM,CACXd,UAAU,CACVI,YAAY,CACZC,WAAW,CACXC,mBACF,CAAC,CAAGT,YAAY,CAACkB,OAAO,CAExB,cAAe,CAAAlB,YAAY,CAACmB,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}